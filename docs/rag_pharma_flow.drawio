<mxfile host="65bd71144e">
    <diagram name="RAG_PharmaChatBot" id="0">
        <mxGraphModel dx="933" dy="553" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="1200" pageHeight="800" math="0" shadow="0">
            <root>
                <mxCell id="0"/>
                <mxCell id="1" parent="0"/>
                <mxCell id="pharma_csv" value="Pharma CSV&#xa;load_clean_csv()&#xa;cleaned reason + normalize" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#E6F0FF;strokeColor=#5B8DEF;" parent="1" vertex="1">
                    <mxGeometry x="40" y="40" width="180" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="pharma_db" value="Postgres&#xa;pharma_suggestions" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#E6F7F0;strokeColor=#2E8B57;" parent="1" vertex="1">
                    <mxGeometry x="260" y="40" width="200" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="pharma_embed" value="Embed + Upsert&#xa;record_type=pharma" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FFF3E6;strokeColor=#F39C12;" parent="1" vertex="1">
                    <mxGeometry x="680" y="40" width="200" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="web_seed" value="Web CSV Seeds" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#F5F5F5;strokeColor=#777777;" parent="1" vertex="1">
                    <mxGeometry x="40" y="150" width="180" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="rss_ingest" value="RSS Ingestion&#xa;Entrez abstracts&#xa;article extraction" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#F5F5F5;strokeColor=#777777;" parent="1" vertex="1">
                    <mxGeometry x="40" y="230" width="200" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="pdf_ingest" value="PDF Ingestion&#xa;Chunking + page text" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#F5F5F5;strokeColor=#777777;" parent="1" vertex="1">
                    <mxGeometry x="40" y="310" width="200" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="web_db" value="Postgres&#xa;web_suggestions" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#E6F7F0;strokeColor=#2E8B57;" parent="1" vertex="1">
                    <mxGeometry x="270" y="150" width="200" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="web_embed" value="Embed + Upsert&#xa;record_type=web" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FFF3E6;strokeColor=#F39C12;" parent="1" vertex="1">
                    <mxGeometry x="520" y="150" width="200" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="qdrant" value="Qdrant Vector DB" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#EFEFEF;strokeColor=#555555;" parent="1" vertex="1">
                    <mxGeometry x="680" y="270" width="200" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="router" value="Hybrid Router&#xa;rules + LLM&#xa;select corpus + filters" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#E8E0FF;strokeColor=#6C4EB6;" parent="1" vertex="1">
                    <mxGeometry x="680" y="360" width="200" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="retriever_pharma" value="Retriever (Pharma)&#xa;Qdrant + SQL enrich" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#E6F0FF;strokeColor=#5B8DEF;" parent="1" vertex="1">
                    <mxGeometry x="440" y="420" width="200" height="50" as="geometry"/>
                </mxCell>
                <mxCell id="retriever_web" value="Retriever (Web)&#xa;Qdrant + SQL enrich" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#E6F0FF;strokeColor=#5B8DEF;" parent="1" vertex="1">
                    <mxGeometry x="920" y="420" width="200" height="50" as="geometry"/>
                </mxCell>
                <mxCell id="pharma_rag" value="Pharma RAG&#xa;LLM filters + rerank&#xa;(rep, HCP, specialty, channel)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#E6F0FF;strokeColor=#5B8DEF;" parent="1" vertex="1">
                    <mxGeometry x="450" y="485" width="200" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="web_rag" value="Web RAG&#xa;source filters + details&#xa;(source_type, domain, dates)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#E6F0FF;strokeColor=#5B8DEF;" parent="1" vertex="1">
                    <mxGeometry x="920" y="485" width="200" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="answer" value="LLM Answer + Citations" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#E6F7F0;strokeColor=#2E8B57;" parent="1" vertex="1">
                    <mxGeometry x="680" y="560" width="200" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="api" value="FastAPI /ask" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FFF7E6;strokeColor=#D68910;" parent="1" vertex="1">
                    <mxGeometry x="500" y="660" width="200" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="validation" value="Validation Suite&#xa;DB + Qdrant + Retrieval + Faithfulness + Routing" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#F0F8FF;strokeColor=#4A6FA5;" parent="1" vertex="1">
                    <mxGeometry x="740" y="660" width="320" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="models" value="Models &amp; Packages&#xa;Embeddings: text-embedding-3-small&#xa;LLM: openai/gpt-4o-mini&#xa;Vector DB: Qdrant&#xa;RSS: feedparser + httpx + trafilatura&#xa;PDF: pypdf + langchain-text-splitters" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#F7F3FF;strokeColor=#8E6AC1;" parent="1" vertex="1">
                    <mxGeometry x="40" y="660" width="420" height="100" as="geometry"/>
                </mxCell>
                <mxCell id="e1" style="endArrow=block;html=1;strokeColor=#555555;" parent="1" source="pharma_csv" target="pharma_db" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="e2" style="endArrow=block;html=1;strokeColor=#555555;" parent="1" source="pharma_db" target="pharma_embed" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="e3" style="endArrow=block;html=1;strokeColor=#555555;" parent="1" source="pharma_embed" target="qdrant" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="e4" style="endArrow=block;html=1;strokeColor=#555555;" parent="1" source="web_seed" target="web_db" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="e5" style="endArrow=block;html=1;strokeColor=#555555;" parent="1" source="rss_ingest" target="web_db" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <Array as="points">
                            <mxPoint x="260" y="240"/>
                        </Array>
                    </mxGeometry>
                </mxCell>
                <mxCell id="e6" style="endArrow=block;html=1;strokeColor=#555555;" parent="1" source="pdf_ingest" target="web_db" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <Array as="points">
                            <mxPoint x="320" y="300"/>
                        </Array>
                    </mxGeometry>
                </mxCell>
                <mxCell id="e7" style="endArrow=block;html=1;strokeColor=#555555;" parent="1" source="web_db" target="web_embed" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="e8" style="endArrow=block;html=1;strokeColor=#555555;" parent="1" source="web_embed" target="qdrant" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="e9" style="endArrow=block;html=1;strokeColor=#555555;" parent="1" source="qdrant" target="router" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="e10" style="endArrow=block;html=1;strokeColor=#555555;" parent="1" source="router" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="597.6000000000001" y="485" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="e11" style="endArrow=block;html=1;strokeColor=#555555;" parent="1" source="router" target="web_rag" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="e10a" style="endArrow=block;html=1;strokeColor=#555555;" parent="1" source="router" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="640" y="422.08333333333337" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="e11a" style="endArrow=block;html=1;strokeColor=#555555;" parent="1" source="router" target="retriever_web" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="e10b" style="endArrow=block;html=1;strokeColor=#555555;" parent="1" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="540" y="470" as="sourcePoint"/>
                        <mxPoint x="540" y="485" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="e11b" style="endArrow=block;html=1;strokeColor=#555555;" parent="1" source="retriever_web" target="web_rag" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="e12" style="endArrow=block;html=1;strokeColor=#555555;" parent="1" target="answer" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="635.9999999999998" y="545" as="sourcePoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="e13" style="endArrow=block;html=1;strokeColor=#555555;" parent="1" source="web_rag" target="answer" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="e14" style="endArrow=block;html=1;strokeColor=#555555;" parent="1" source="answer" target="api" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="e15" style="endArrow=block;html=1;strokeColor=#555555;" parent="1" source="api" target="validation" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
            </root>
        </mxGraphModel>
    </diagram>
</mxfile>